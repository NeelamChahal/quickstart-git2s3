Deploying this Quick Start builds the following environment in the AWS Cloud.

// Replace this example diagram with your own. Send us your source PowerPoint file. Be sure to follow our guidelines here : http://(we should include these points on our contributors giude)

:xrefstyle: short
[#architecture_diagram]
.Git webhooks with AWS services Quick Start architecture
[link=images/architecture_diagram.png]
image::../images/architecture_diagram.png[architecture_diagram,width=100%,height=100%]

The Quick Start deployment sets up a serverless AWS Cloud environment that includes the following components:

* An Amazon API Gateway endpoint to accept Git webhook requests.
* An AWS Lambda function to process Git webhook requests and invoke AWS CodeBuild.
* A CodeBuild project to compress and upload the Git repository code to an Amazon S3 bucket.

IMPORTANT: The CodeBuild project that is deployed by this Quick Start must be able to connect to your Git repository, either over SSH (Secure Shell) or through the Git service endpoint. For example, you can use a SaaS-based Git service to which AWS CodeBuild can connect over the internet.

* AWS Key Management Service (AWS KMS) to encrypt the private keys used to connect to the Git repository with SSH.
* Two Amazon Simple Storage Service (S3) buckets, one to store the compressed Git repository code, and another to store the private SSH keys encrypted by AWS KMS. 

NOTE: The first S3 bucket has versioning enabled, and all previous versions are retained indefinitely. To modify the retention period, see http://docs.aws.amazon.com/AmazonS3/latest/user-guide/create-lifecycle.html[How do I create a lifecycle rule for an S3 bucket?].

* AWS Identity and Access Management (IAM) roles required by Lambda and API Gateway. The inline permissions attached to these roles are scoped using the http://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege[least privilege] model.

* Two Lambda-backed AWS CloudFormation custom resources. One resource generates an SSH key pair, encrypts it using AWS KMS, and stores it in an S3 bucket. The second resource deletes the contents of the two S3 buckets when you delete the CloudFormation stack.

WARNING: If you need backups, copy the contents of the S3 buckets before deleting the AWS CloudFormation stack.

== Webhook endpoints

This Quick Start deploys two endpoints for connecting to your Git repository. Each endpoint has different benefits. Choose the endpoint that best fits your use case, repository size, and other requirements.

[cols="1,2,3a"]
|===
Endpoint | Description | Benefits

| Zip download | Uses the Git service's HTTP API to download a .zip file of the entire repository. | 

* No need for external libraries.
* Smaller Lambda function code.
* Large repository size limit (500 MB).

| Git pull | Uses SSH to pull from the Git repository. The repository contents are then zipped and uploaded to Amazon S3. |

* Efficient for repositories with a high volume of commits, because each time the API is triggered, it downloads only changed files.
* Suitable for any Git server that supports webhooks and SSH. Does not depend on personal access tokens or OAuth2.
* More extensible because it uses a standard Git library.

|===

